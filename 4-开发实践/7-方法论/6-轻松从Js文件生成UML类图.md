进行中...

# 轻松从Js文件生成UML类图

## 前言

上一篇《函数式编程入门经典》，罗嗦了很长，很多小伙伴看得云里雾里。这里提供一个实例，让大家切身感受函数式编程的奥妙和趣味。当然，仅仅为了举例而写代码就没有什么意义了，本书提供的例子都是承担了某项任务的具体项目或工具，这个例子自然也不能例外。

本书用到了大量的Uml类图，经常有小伙伴问我用什么工具画的。说实话，前几篇是我个人一点点手工整理的，但后来就感觉在浪费生命，作为程序员，怎么可能容忍这样的事情反复发生。所以，就有了 [js2uml][] 这个小工具。只不过，当初目的单一，仅仅使用正则表达式过滤js代码（[v0.1.0][]），所以不够灵活，自然也没有单独放出来。现在引入了抽象语法树，顺带使用函数式编程进行了重构，也让该工具更加通用了。

因为代码量很少，并且前面对函数式编程进行了大量阐述，这里就不再详细描述编码过程了，仅仅把设计思路和流程提供出来，喜欢的小伙伴请自己查阅源代码吧。

## 工具简要介绍

这是一个命令行工具，主要实现了以下两个功能：

（1）直接读取js源码，产生 [plantuml][] 认识的格式文件。我个人喜欢用`.pu`作为后缀。内容格式，比如：

```
@startuml
title 区块链相关类图及其关联关系
footer copyright (c) imfly 2016.07.23 http://bitcoin-on-nodejs.ebookchain.org
header 《Nodejs开发加密货币》分析用图：《区块链》

  Class Loader {
    ...
  }

  ' relationship
  Block -right-> transaction
@enduml
```

然后，使用 [Graphviz][] 工具就可以导出png等格式的图片了。之所以提供导出这类格式的文件，主要是工具对于排版的处理还不够智能，布局、关联关系、背景图片等，有时需要通过手工进一步修改。另外，这也为以后与其他工具的集成，提供了便利。

（2）直接生成png,svg等格式的图片文件。这是对 [Graphviz][] 的直接扩展。

具体安装使用方法非常简单，请直接查看它的文档吧，这里不再赘述。

#### 能从中学点什么？

通过这个小工具的开发，可以学习到下面的技能：

* 抽象语法树（Abstract Syntax Tree, AST）的处理。抽象语法树有很多用途，大部分人可能很少直接在代码里使用，但是几乎每个人也都在用，比如：编辑器的自动提示、自动完成等功能，使用Nodejs的小伙伴，最后都要对代码进行混淆、压缩等处理，那些工具也都要用到；
* 函数式编程。原来的版本，是完全面向对象的编程方式，也没有使用AST，所以代码长，功能有限。这个版本，进行了优化，使用函数式编程，大大缩减了代码量，还提供了直接导出.png/.svg/.pu等各种格式图片的能力;
* 学习plantuml。这是使用代码处理Uml的最好方式，直接使用dot语言（生成的.pu文件就是），像编写程序一样画Uml图，真的只有程序猿才能体会的畅快。
* 命令行工具开发。

## 关于抽象语法树

抽象语法树是程序的一种中间表示形式，在程序分析等领域有广泛的应用。凡是涉及到对源程序进行操作和处理的应用，都会用到抽象语法树，比如我们大家经常使用的智能编辑器、语言翻译器等。

## 工具实现过程

#### （1）基本需求



#### （2）架构流程

#### （3）代码结构

## 链接

**本系列文章即时更新，若要掌握最新内容，请关注下面的链接**

本源文地址： https://github.com/imfly/bitcoin-on-nodejs

亿书官网： http://ebookchain.org

亿书官方QQ群：185046161（亿书完全开源开放，欢迎各界小伙伴参与）

## 参考

[Abstract syntax tree](https://en.wikipedia.org/wiki/Abstract_syntax_tree)

[《Nodejs开发加密货币》]: https://github.com/imfly/bitcoin-on-nodejs
[Graphviz]: http://www.graphviz.org/
[js2uml]: https://github.com/imfly/js2uml
[v0.1.0]: https://github.com/imfly/js2uml/releases/tag/v0.1.0
