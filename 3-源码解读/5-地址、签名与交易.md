进行中...

# 地址、签名与交易

## 前言

上一篇，我们专门研究了《在Nodejs中使用加密解密技术》，明白了加密解密的使用。并在讲解加密解密技术的过程中，用已经说过，亿书的帐号就是地址，而且详细阅读了地址产生的过程。但是，从开发的角度来说，远远不够，因为产生的密钥地址如何持久化到数据库？如何检索？如何用来签名？怎么实现交易的？

本篇文章，就从业务逻辑的角度，看看亿书的帐号、签名和交易是如何实现的。

## 源码

account.js https://github.com/Ebookcoin/ebookcoin/blob/master/logic/account.js

accounts.js https://github.com/Ebookcoin/ebookcoin/blob/master/modules/accounts.js

contacts.js https://github.com/Ebookcoin/ebookcoin/blob/master/modules/contacts.js


signatures.js https://github.com/Ebookcoin/ebookcoin/blob/master/modules/signatures.js


transactions.js https://github.com/Ebookcoin/ebookcoin/blob/master/modules/transactions.js

transaction.js https://github.com/Ebookcoin/ebookcoin/blob/master/logic/transaction.js

transaction-types.js https://github.com/Ebookcoin/ebookcoin/blob/master/helpers/transaction-types.js

## 1.别名地址

计算机软件是人类活动的模拟和程序化，也就是大家所谓的“虚拟化”。在设计的时候，都会设想一个角色（Role）代替人类，负责完成要开发的各类操作。这个角色，通常在开发中被定义为用户（User），用户看到并可操作的就是用户帐号，在此基础上，才能进行权限认证，记录和管理与用户有关的各类操作。

比特币里的用户角色仅仅就是一个比特币地址，而因为真实网络的复杂性，对于IP的追踪也不容易，所以说比特币的匿名性很好（因为压根就没有给你暴露名字的机会）。亿书，要做版权保护的应用，如果再进行完全的匿名操作，显然有点不合适，属于跟自己过不去。同时，复杂的字符串地址也不适合人类脑记，不方便与他人协作和交互，因此亿书给出了“别名地址”的功能，并对“社交功能”进行了强化。相见 [亿书白皮书][] 。

具体操作时，可以实现下面的需求：

- 用户可以注册一个用户名，它相当于是用户帐户的一个别名。类似于人们常用的支付宝帐号，其它用户可以直接向该用户的用户名付款，用户不再需要记下一长串的加密货币地址;
- 用户名都是唯一的;
- 注册后无法更改或删除;
- 用户可以维护一个联系人列表;

这些操作和信息，都可以在客户端里完成，如下图所示：

![wallet-username][]

## 类图

## 流程图

## 解读

#### 1.数据库结构

保存用户信息的表是`mem_accounts`，主要包含字段：

```
username，isDelegate，u_isDelegate，secondSignature，u_secondSignature，u_username，address，publicKey，secondPublicKey，balance，u_balance，vote，rate，delegates，contacts，followers，u_delegates，u_contacts，u_followers，multisignatures，u_multisignatures，multimin，u_multimin，multilifetime，u_multilifetime，blockId，nameexist，u_nameexist，producedblocks，missedblocks，virgin，fees，rewards
```

操作数据库的代码在`logic/account.js`里，


## 总结

## 链接

## 参考

[亿书白皮书]: http://ebookchain.org/ebookchain.pdf

[wallet-username]: ../wallet-username.jpg
